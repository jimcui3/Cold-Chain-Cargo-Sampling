## 分层抽样在冷链食品抽检上的应用

​	对于一批货物，可以根据以往的信息得知，不同种类产品携带新冠病毒的概率是不同的，这时候我们可以将携带病毒概率不同的货物进行分层，对于每一层的货物采用随机抽样的方式抽取对应的样本，在保证检出率的条件下，合适地选取每一层的样本，能一定程度上降低检测的样本总数。

#### **一、理论推导**

##### （一）推导过程

​	记总体容量为$N$，将总体分成$L$层，每层的总体数分别为$N_1$，$N_2$， $...$,$N_L$，假设每层分别有假设每层分别有$k_1$，$k_2$,$...$,$k_L$个阳性个体，对每一层分别抽取$n_1$，$n_2$,$...$,$n_L$，样本总量为$n$，则检出率$p$的计算公式如下：
$$
p=1-{{N_1-k_1 \choose n_1} \over {N_1 \choose n_1}}\times{{N_2-k_2 \choose n_2} \over {N_2 \choose n_2}}\times\cdots\times{{N_L-k_L \choose n_L} \over {N_L \choose n_L}}
$$
​	其中,对于任意 $i \in \{1,2,...,L\}​$,有
$$
\begin{aligned}
{{N_i-k_i \choose n_i} \over {N_i \choose n_i}}=\frac{(N_i-n_i)!\times(N_i-k_i)}{N_i!(N_i-k_i-n_i)!}=(1-\frac{k_i}{N_i})(1-\frac{k_i}{N_i-1})\cdots(1-\frac{k_i}{N_i-n_i-1})
\end{aligned}
$$
​	当每一层的总体容量远大于抽取的样本量时，有如下近似
$$
\frac{k_i}{(N_i-s+1)}≈\frac{k_i}{N_i}   ,s=1,2,…,n_i，if(N_i≫n_i)
$$
​	因此，检出率 $p​$ 可以近似计算为
$$
p≈1-(1-\frac{k_1}{N_1})^{n_1}(1-\frac{k_2}{N_2})^{n_2}⋯(1-\frac{k_L}{N_L})^{n_L}
$$
​	我们将分层抽样与简单随机抽样进行比较，由于简单随机抽样的抽出率为
$$
p_{SRS}≈1-(1-\frac{k_1+k_2+⋯+k_L}{N_1+N_2+⋯+N_L})^{n_1+n_2+⋯+n_L}
$$
​	我们只需比较样本总量相同时， $p$与 $p_{SRS}​$的大小即可得知两种抽样方法的优劣。我们考虑样本量采取样本按比例分配时的情形，即
$$
\frac{n_i}{n_1+n_2+⋯+n_L}=\frac{N_i}{N_1+N_2+⋯+N_L}，∀i∈\{1,2,…L\}
$$
​	因为函数$f(x)=\ln{(1-x)}​$为上凸函数，所以由Jensen不等式,结合（3）,（4）和（5），有如下不等式成立：
$$
\begin{aligned}
f(1-p)=\ln⁡(1-p)&=\displaystyle \sum^{L}_{i=1}n_i×\ln⁡(1-\frac{k_i}{N_i})\\
&\leq(n_1+n_2+⋯+n_L)\ln⁡(1-\displaystyle \sum^{L}_{i=1}\frac{n_i}{n_1+n_2+⋯+n_L}×\frac{k_i}{N_i})\\
&\leq(n_1+n_2+⋯+n_L)\ln⁡(1-\displaystyle \sum^{L}_{i=1}\frac{N_i}{N_1+N_2+⋯+N_L}×\frac{k_i}{N_i})\\
&=(n_1+n_2+⋯+n_L)\ln⁡(1-\frac{k_1+k_2+\cdots+k_L}{N_1+N_2+⋯+N_L})\\
&=\ln(1-p_{SRS})=f(1-p_{SRS})
\end{aligned}
$$
​	再由函数$f(x)=\ln(1-x)$恒单调递减可知，总有$p\geq p_{SRS}$成立，等号当且仅当$\frac{k_1}{N_1}=\frac{k_2}{N_2}=\cdots=\frac{k_L}{N_L}$时成立，即所有类型的货物感染病毒概率相同时，两种抽样方法抽出率相同。

##### （二）结果分析

​	从上述推导过程可以看出，在按比例分配的样本分配方式下，分层抽样的抽出率 $p$ 总是不低于简单随机抽样的抽出率$p_{SRS}$，这说明分层抽样的方法比简单随机抽样的方法更加高效。

##### （三）样本总量 $n$ 与检出率 $p$ 之间的关系式

​	由
$$
N=N_1+N_2+⋯+N_L  
$$

$$
n=n_1+n_2+⋯+n_L  
$$

​	结合（3），（4）可以得出在样本量足够大时，样本总量$n$与检出率$p$之间的关系式。

简单随机抽样:
$$
n=\frac{ln⁡(1-p)}{ln⁡(1-\frac{k_1+k_2+⋯+k_L}{N_1+N_2+⋯+N_L})}
$$
分层抽样：
$$
n=\frac{ln⁡(1-p)}{\frac{1}{N}\left[\displaystyle \sum^{L}_{i=1}N_i×ln⁡(1-k_i/N_i)\right]}
$$

#### **二、模拟实验**

##### （一）试验过程及试验结果

​	下面我们通过模拟实验，研究在保证检出率达到99%以上的条件下，各层用按比例分配的方式选取样本所需的样本总量的大小，并且与简单随机抽样和整群抽样进行比较。

​	假设总体个数N=10000，分10层，每层的总体个数为1000，即$N_1=N_2=\cdots=N_{10}=1000​$, 考虑以下几种情形：

|            | 第一层感染率 | 第二层感染率 | 第三层感染率 | 第四层感染率 | 第五层感染率 | 第六层感染率 | 第七层感染率 | 第八层感染率 | 第九层感染率 | 第十层感染率 |
| :--------: | :----------: | :----------: | :----------: | ------------ | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| **情形一** |    0.005     |    0.005     |    0.005     | 0.005        |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |
| **情形二** |    0.010     |    0.005     |    0.005     | 0.005        |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |
|            |    0.100     |    0.005     |    0.005     | 0.005        |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |    0.005     |
|            |    0.010     |    0.001     |    0.001     | 0.001        |    0.001     |    0.001     |    0.001     |    0.001     |    0.001     |    0.001     |
|            |    0.010     |    0.0005    |    0.0005    | 0.0005       |    0.0005    |    0.0005    |    0.0005    |    0.0005    |    0.0005    |    0.0005    |
| **情形三** |    0.010     |  0.01*0.9^1  |      …       | …            |      …       |      …       |      …       |      …       |      …       |  0.01*0.9^9  |

​	情形一模拟的是每种货物感染病毒概率相同时的情形；情形二模拟的是感染病毒概率不同的货物放在一起，而存在某种货物感染概率较高时的情形；情形三模拟的是病毒存在扩散性质，货物感染率与离感染源的距离成正相关时的情形。

​	经过模拟抽样（具体R语言代码见附件），我们得出：

​	情形一的时候，分层抽样保证检出率达到99%以上所需的样本总量n为818，对应的简单随机抽样需要的样本总量n为878，整群抽样所需的样本总量为923。

​	情形二的时候，分层抽样保证检出率达到99%以上，四种情况下所需的样本总量n依次为762、298、2078、2670，对应的简单随机抽样需要的样本总量n分别为835、315、2421、3068，而整群抽样所需的样本总量n分别为862，780，2526，3518。

​	情形三的时候，分层抽样保证检出率达到99%以上所需的样本总量n为673，对应的简单随机抽样需要的样本总量n为753，整群抽样所需的样本总量为796。

|        | 分层抽样所需样本总量 | 简单随机抽样所需样本总量 | 整群抽样所需样本总量 |
| :----: | :------------------: | :----------------------: | :------------------: |
| 情形一 |         818          |           878            |         923          |
| 情形二 |         762          |           835            |         862          |
|        |         298          |           315            |         780          |
|        |         2078         |           2421           |         2526         |
|        |         2670         |           3068           |         3518         |
| 情形三 |         673          |           753            |         796          |

##### （二）结果分析

​	从上述试验结果，我们可以看出，在保证相同的检出率（99%）的条件下，分层抽样所需的样本总量总是比简单随机抽样以及整群抽样所需的样本总量要少。

​	这说明了相对于简单随机抽样及整群抽样而言，采用分层抽样不仅能够保证抽检的质量，也能减少抽检的样本总量，减少人力成本。

​	而对于整群抽样而言，我们可以看到整群抽样模拟所需的样本量比简单随机抽样还要多，究其原因，是由于冷链抽检本身的特性，由于病毒在总体中分布不均匀，群与群之间的差异很大，而群内的差异较小，导致每个群的代表性不足，使得整群抽样的结果比简单随机抽样要差。

#### 三、结论

​	通过第一部分的理论推导，我们证明了分层抽样在冷链抽检中相对于简单随机抽样的优越性；并且通过第二部分的模拟实验，我们也可以看出，分层抽样相对于简单随机抽样及整群抽样而言能够以更少的样本量达到相同的抽检率，这从另一个方面中佐证了分层抽样在冷链抽检中的所具有的优良的性质。

****

#### **附件：用R语言模拟分层抽样和整群抽样**

**（一）算法主要思想：**

​	输入：各层的感染率向量p，进行模拟的次数B，对n进行模拟的起点starting_point，n的上限ending_point，n自加的步长stepsize.

​	输出：抽样所需要的样本数n的向量ans，并根据ans输出n的均值和正态95%CI.

​	步骤1：各层根据感染率向量p，用rbinom函数随机生成数据，如果数据集中所有数据全是阴性，则重新生成数据.

​	步骤2：创造一空向量test，用来存储抽取的样本中是否有阳性样本。对检出率进行1000次蒙特卡洛模拟，第i次模拟为：依据此数据集进行按比例抽样，若抽得的所有样本均为阴性，则test[i]赋值为0，否则赋值为1.

​	步骤3：当1000次模拟结束后，用test的均值作为检出率的估计值，若检出率＜0.99且n不超过给定的上限，则根据给定的步长增加抽取样本数n，返回第2步；否则，输出n.

​	步骤4：重复步骤1~步骤3共B次，最后得到的向量ans长度为B，可以算出n的平均值和正态近似的95%CI.

**（二）具体代码实现**

